<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Detecting Fraudulent Transactions in Credit Cards - The Realm of Data Science</title>
<meta name="description" content="Using R and machine learning for Credit Card Fraud detection ">


  <meta name="author" content="Pavitra Prabhu">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="The Realm of Data Science">
<meta property="og:title" content="Detecting Fraudulent Transactions in Credit Cards">
<meta property="og:url" content="http://localhost:4000/projects/credit-card-fraud-detection-in-r/">


  <meta property="og:description" content="Using R and machine learning for Credit Card Fraud detection ">



  <meta property="og:image" content="http://localhost:4000/img/Project/ProjectTeaser/thumbnail_creditcardfraud.jpg">





  <meta property="article:published_time" content="2020-12-01T21:12:28-06:00">





  

  


<link rel="canonical" href="http://localhost:4000/projects/credit-card-fraud-detection-in-r/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Pavitra Prabhu",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="The Realm of Data Science Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          The Realm of Data Science
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/projects/">Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/learning/">Learning</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Pavitra Prabhu</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>My adventure in Data Science and Analytics</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Waukesha, WI</span>
        </li>
      

      
        
          
            <li><a href="mailto:pavitrashivananda.prabhu@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://github.com/prabhupavitra?tab=repositories" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Detecting Fraudulent Transactions in Credit Cards">
    <meta itemprop="description" content="Using R and machine learning for Credit Card Fraud detection">
    <meta itemprop="datePublished" content="2020-12-01T21:12:28-06:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Detecting Fraudulent Transactions in Credit Cards
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p><img src="/img/Project/ProjectTeaser/creditcardfraud.png" alt="this is a placeholder image" width="100%" height="50%" class="center" /></p>

<h4 id="introduction">Introduction</h4>

<p><span style="font-family:Georgia; font-size:18px;">
Nowadays, artificial intelligence(AI) is being used in all realms of business. One such interesting application of machine learning is online fraud detection. With increased sophistication and scale of fraudulent transactions, fraud detection has become one of the indispensable tool for every organization. The conventional approaches to fighting online fraud include predictive models and are rule based. These are no longer effective at tackling advanced levels of current fraud attempts. Online fraud detection needs AI to stay well ahead of the current sophistication of fraudsters. This motivates the need to build a fraud detection system.</span></p>

<h4 id="ieee-cis-fraud-detection-dataset">IEEE-CIS Fraud Detection Dataset</h4>
<p><span style="font-family:Georgia; font-size:18px;">
The dataset used in this analysis comes from Kaggle competition, IEEE Fraud Detection-CIS 2019 Technical Challenge. The data on kaggle is broken into two files identity and transaction, which are joined by TransactionID. Not all transactions have corresponding identity information. The data is  collected by Vesta’s fraud protection system and digital security partners. Vesta Corporation is the forerunner in guaranteed e-commerce payment solutions. Founded in 1995, Vesta pioneered the process of fully guaranteed card-not-present (CNP) payment transactions for the telecommunications industry.</span>  <br />
<span style="font-family:Georgia; font-size:18px;">
However, the data used in this analysis is the training dataset provided for this competition. The test set was not used in this analysis since we do not have labels for evaluating the performance on the test set. The purpose of this analysis is to predict the probability that an online transaction is fraudulent, as denoted by the binary target isFraud.</span> <br />
<span style="font-family:Georgia; font-size:18px;">
The following is a summary of features of the dataset.</span></p>

<p><span style="font-family:Georgia; font-size:18px;">
Outcome variable :</span></p>

<ul>
  <li><span style="font-family:Georgia; font-size:18px;"> isFraud : Binary target variable (0 : Legitimate, 1 : Fraud)</span></li>
</ul>

<p><span style="font-family:Georgia; font-size:18px;"> Categorical Features : </span></p>

<ul>
  <li><span style="font-family:Georgia; font-size:18px;"> ProductCD: product code, the product for each transaction.</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> card1 - card6: payment card information, such as card type, card category, issue bank, country, etc.</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> addr1, addr2: address</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> P_emaildomain: purchaser email domain</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> R_emaildomain: recipient email domain</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> M1-M9: match, such as names on card and address, etc.</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> DeviceType</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> DeviceInfo</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> id_12 - id_38 : identity information – network connection information (IP, ISP, Proxy, etc) and digital signature (UA/browser/os/version, etc) associated with transactions. </span></li>
</ul>

<p><span style="font-family:Georgia; font-size:18px;"> Numeric Features : </span></p>

<ul>
  <li><span style="font-family:Georgia; font-size:18px;"> TransactionDT: timedelta from a given reference datetime (not an actual timestamp).</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> TransactionAMT: transaction payment amount in USD.</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> dist1, dist2: distance</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> C1-C14: counting, such as how many addresses are found to be associated with the payment card,etc. (The actual meaning is masked.)</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> D1-D15: timedelta, such as days between previous transaction, etc.</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> Vxxx: Vesta engineered rich features, including ranking, counting, and other entity relations.</span></li>
  <li><span style="font-family:Georgia; font-size:18px;"> id_01 - id_11 : identity information.</span></li>
</ul>

<h2 id="loss-functions">Loss Functions</h2>

<p><span style="font-family:Georgia; font-size:18px;"> 
Machine learning models are evaluated by means of a loss function. The loss function evaluates the performance of each model and the metric is chosen depending on the kind of task involved in machine learning. Since the main goal of our project is binary classfication (i.e. two possible classes 0 or 1), we will focus on metrics commonly used for binary classifiers. Accuracy and ROC are the most commonly used evaluation metrics for binary classifiers.</span> <br />
<span style="font-family:Georgia; font-size:18px;">
However, when the dataset is imbalanced, it is very easy to achieve high accuracy just by classifying everything to the majority class. For example, in fraud detection datasets, majority of the transactions are legitimate and the models can achieve higher accuracy just by classifying all the transactions as legitimate. Therefore, we choose AUC for calibrating our models.</span></p>

<h3 id="aucarea-under-receiver-operating-characteristic-curve">AUC(Area Under Receiver Operating Characteristic Curve)</h3>
<p><span style="font-family:Georgia; font-size:18px;">
One of the most commonly used metric to visualize the performance of a binary classifier, is the Receiver Operating Characteristic Curve(ROC) and Area Under Curve(AUC) is the best way to summarize its performance in a single number. Here, the curve refers to the ROC curve.</span></p>

<h2 id="project-checklist">Project Checklist</h2>

<p><span style="font-family:Georgia; font-size:18px;">
Evidently, the first step in building a machine learning model involves framing the problem and getting the data. Then, we choose an appropriate performance metric to rightly assess our models. These metrics are also called loss functions. This is followed by data exploration and data visualization tasks. We then proceed to data preprocessing. There are various tasks involved in this stage from feature selection to handling missing data, encoding the data and splitting the data appropriately. Once this is completed, the next step is generally termed as the prototyping phase, where we train and test various candidate models and select the best model using model selection. The main task of prototyping phase is to select the model. This is followed by hyperparameter tuning, for optimizing our loss function. Once we are satisfied with our prototype model, the same is deployed in production to put it through further testing on live data.</span></p>

<h1 id="methods-and-analysis">Methods and Analysis</h1>

<h2 id="data-ingestion">Data Ingestion</h2>
<p><span style="font-family:Georgia; font-size:18px;">
In this stage, we download the data and prepare the dataset to be used in the analysis. The dataset is split into two datasets: df and validation with 90% and 10% of the original dataset respectively. We take the validation set and put it off to the side, pretending that we have never seen it before.</span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#### Create df set, validation set (final hold-out test set)</span><span class="w">
</span><span class="c1"># Note: this process could take a couple of minutes</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">plyr</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"plyr"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"tidyverse"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">caret</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"caret"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">data.table</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"data.table"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">lubridate</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"lubridate"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">utils</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"utils"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">reshape2</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"reshape2"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">ipred</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"ipred"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">e1071</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"e1071"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">pROC</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"pROC"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">xgboost</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"xgboost"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">DMwR</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"DMwR"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">vip</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"vip"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">randomForest</span><span class="p">))</span><span class="w"> </span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"randomForest"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://cran.us.r-project.org"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">data.table</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">utils</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">pROC</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ipred</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">e1071</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">xgboost</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">xgboost</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">DMwR</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">vip</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">randomForest</span><span class="p">)</span><span class="w">
</span><span class="c1"># Download files from dropbox link</span><span class="w">
</span><span class="n">dl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tempfile</span><span class="p">()</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="s2">"https://dl.dropboxusercontent.com/s/05kl7ogmpsx044j/ieee_cis_fraud_detection.zip"</span><span class="p">,</span><span class="w"> </span><span class="n">dl</span><span class="p">)</span><span class="w">
</span><span class="n">identification</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="n">unzip</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span><span class="w"> </span><span class="s2">"ieee_cis_fraud_detection/train_identity.csv"</span><span class="p">))</span><span class="w">
</span><span class="n">transactions</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="n">unzip</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span><span class="w"> </span><span class="s2">"ieee_cis_fraud_detection/train_transaction.csv"</span><span class="p">))</span><span class="w">
</span><span class="n">fraud_det_set</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">transactions</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">identification</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="s2">"TransactionID"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Validation set will be 10% of fraud_det_set data</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">sample.kind</span><span class="o">=</span><span class="s2">"Rounding"</span><span class="p">)</span><span class="w">
</span><span class="n">test_index</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fraud_det_set</span><span class="o">$</span><span class="n">isFraud</span><span class="p">,</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fraud_det_set</span><span class="p">[</span><span class="o">!</span><span class="n">row.names</span><span class="p">(</span><span class="n">fraud_det_set</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">test_index</span><span class="p">,]</span><span class="w">
</span><span class="n">validation</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fraud_det_set</span><span class="p">[</span><span class="n">row.names</span><span class="p">(</span><span class="n">fraud_det_set</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">test_index</span><span class="p">,]</span><span class="w">
</span><span class="n">validation_y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">validation</span><span class="p">,</span><span class="n">isFraud</span><span class="p">)</span><span class="w">
</span><span class="n">validation_x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">validation</span><span class="p">,</span><span class="o">-</span><span class="n">isFraud</span><span class="p">)</span><span class="w">
</span><span class="c1"># Removing unwanted objects</span><span class="w">
</span><span class="n">rm</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span><span class="n">identification</span><span class="p">,</span><span class="w"> </span><span class="n">transactions</span><span class="p">,</span><span class="n">fraud_det_set</span><span class="p">,</span><span class="n">test_index</span><span class="p">,</span><span class="n">validation</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="create-helper-functions">Create Helper Functions</h2>
<p><span style="font-family:Georgia; font-size:18px;">
In this section, we will create the helper functions needed for this dataset for analysis and performance evaluation of models. The following code creates necessary helper functions for this project.</span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">##### Create Helper Functions</span><span class="w">
</span><span class="c1"># This function creates one-hot encoded columns of a selected column</span><span class="w">
</span><span class="n">one_hot_encoding</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">colname</span><span class="p">){</span><span class="w">
  </span><span class="c1"># Get the list of possible values category can have</span><span class="w">
  </span><span class="n">possible_val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="n">colname</span><span class="p">]])</span><span class="w">
  </span><span class="n">temp_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">possible_val</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">str_detect</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="n">colname</span><span class="p">]],</span><span class="w"> </span><span class="n">g</span><span class="p">))</span><span class="w">
  </span><span class="p">})</span><span class="w">
  </span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">temp_df</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># This function performs label encoding of the column passed</span><span class="w">
</span><span class="n">label_encoding</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">colname</span><span class="p">){</span><span class="w">
  </span><span class="n">levels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="n">colname</span><span class="p">]]))</span><span class="w">
  </span><span class="n">temp_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="n">colname</span><span class="p">]],</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levels</span><span class="p">))</span><span class="w">
  </span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="n">temp_df</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># This function replaces multiple values of a column with a single value</span><span class="w">
</span><span class="n">replace_columnval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">multiple</span><span class="p">,</span><span class="n">single</span><span class="p">){</span><span class="w">
  </span><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">str_detect</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">paste</span><span class="p">(</span><span class="n">multiple</span><span class="p">,</span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"|"</span><span class="p">)),</span><span class="n">single</span><span class="p">)</span><span class="w">
  </span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="p">)}</span><span class="w">
</span></code></pre></div></div>

<h2 id="exploratory-data-analysis">Exploratory Data Analysis</h2>

<h3 id="outcome---isfraud">Outcome - isFraud</h3>

<p><span style="font-family:Georgia; font-size:18px;">
The response variable of this analysis is the isFraud variable. A value of 0 denotes that a transaction is fraud and 1 denotes that the transaction is legitimate.</span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Class Distribution of Fraudulent vs Legitimate Transactions </span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">..count..</span><span class="p">)</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">..count..</span><span class="p">)),</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.7</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">..count..</span><span class="p">)</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">..count..</span><span class="p">),</span><span class="w"> 
                </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">..count..</span><span class="p">,</span><span class="s2">" "</span><span class="p">,</span><span class="s2">"  ("</span><span class="p">,</span><span class="nf">round</span><span class="p">(</span><span class="n">prop.table</span><span class="p">(</span><span class="n">..count..</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="s1">'%'</span><span class="p">,</span><span class="s2">")"</span><span class="p">)),</span><span class="w"> 
            </span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'count'</span><span class="p">,</span><span class="w"> 
            </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position_dodge</span><span class="p">(</span><span class="m">.9</span><span class="p">),</span><span class="w"> 
            </span><span class="n">size</span><span class="o">=</span><span class="m">2.5</span><span class="p">,</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-0.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">),</span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"Fraud"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scales</span><span class="o">::</span><span class="n">percent</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottom"</span><span class="p">,</span><span class="w"> 
        </span><span class="n">axis.text</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w">
</span></code></pre></div></div>

<figure>
  <img src="/img/Project/p4/fig1.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 1: Class Distribution of Fraudulent vs Legitimate Transactions </figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
Figure 1 displays the class distribution of the transactions. We observe that, the dataset is not relatively balanced. The fraudulent transactions constitute only a small fraction of the dataset. Using this dataset as the basis for our algorithms, without deploying any techniques for balancing the dataset, can lead to errors due to overfitting. This is because the machine learning models tend to  classify all transactions as legitimate to increase the accuracy. Hence, we have to appropriately balance the data before feeding it to the models.</span></p>

<h3 id="quantitative-variables">Quantitative Variables</h3>

<p><span style="font-family:Georgia; font-size:18px;">
There are 384 quantitative predictor variables in our dataset. The following sections discuss each of the variables in detail. </span></p>

<h4 id="transaction-id">Transaction ID</h4>

<p><span style="font-family:Georgia; font-size:18px;">
The transaction ID is the unique identifier of each observation in our dataset.</span></p>

<h4 id="transaction-time-delta">Transaction time delta</h4>

<p><span style="font-family:Georgia; font-size:18px;">
The TransactionDT variable in our dataset gives the transaction timedelta from a given reference datetime. It does not denote an actual timestamp. The following code visualizes the total transaction amount plotted versus the timedelta for every 24 hour period from the origin.</span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># TransactionDT : timedelta from a given reference datetime (not an actual timestamp)</span><span class="w">
</span><span class="c1"># Visualizing days from origin and associated total transaction amount</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">Day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">TransactionDT</span><span class="o">/</span><span class="m">86400</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">TransactionAmt</span><span class="p">,</span><span class="n">TransactionDT</span><span class="p">,</span><span class="n">Day</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">Day</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">txn_amt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">TransactionAmt</span><span class="p">)</span><span class="o">/</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Day</span><span class="p">,</span><span class="n">txn_amt</span><span class="p">,</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_smooth</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vars</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="s2">"24-hour timedelta Relative from Origin"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Total Transaction Amount (in Thousands)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig2.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 2: Visualizing transaction time delta  </figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
Figure 2 illustrates a subtle variation in total transaction amount in a 24-hour timedelta period. Moreover, the variation is similar for both legitimate and fraudulent transactions.  </span></p>

<h4 id="transaction-amount">Transaction amount</h4>

<p><span style="font-family:Georgia; font-size:18px;">
One of the most important details about a transaction is the transaction amount. The following code displays the distribution of transaction amount for legitimate and fraud transactions.  </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Transaction Amount : transaction payment amount in USD</span><span class="w">
</span><span class="c1"># Distribution of Transaction amount by fraudulent vs legitimate transactions</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">TransactionAmt</span><span class="p">,</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_density</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> 
                     </span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Density"</span><span class="p">,</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Transaction Amount (in USD)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_cartesian</span><span class="p">(</span><span class="n">clip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"off"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="n">face</span><span class="o">=</span><span class="s2">"italic"</span><span class="p">),</span><span class="w">
        </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Normalized ecdf of transaction amount of Fraudulent transactions vs Legitimate transactions</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TransactionAmt</span><span class="p">,</span><span class="w">
             </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="m">100</span><span class="o">*</span><span class="n">..y..</span><span class="p">,</span><span class="w">
             </span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">stat_ecdf</span><span class="p">(</span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"step"</span><span class="p">,</span><span class="w"> 
            </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w"> 
            </span><span class="n">pad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">30000</span><span class="p">,</span><span class="m">5000</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Transaction Amount (in USD)"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cumulative Frequency"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_cartesian</span><span class="p">(</span><span class="n">clip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"off"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<figure>
  <img src="/img/Project/p4/fig3.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 3: Distribution of Transaction Amount  </figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
Figure 3 displays the density plot and the ECDF plot for the distribution of the transaction amount.  The distribution is a right skewed distribution, with a few transactions with large amount, but the majority of transactions have transaction amount less than 2000 USD for legitimate transactions and 300 USD for fraudulent transactions.</span></p>

<h4 id="distance">Distance</h4>
<p><span style="font-family:Georgia; font-size:18px;">
We proceed to analyze the distance variable. The below code generates a normalized ECDF for the distance values.  </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### dist1 and dist2 : Distance</span><span class="w">
</span><span class="c1"># Visualizing dist1 and dist2 values  </span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">dist1</span><span class="p">,</span><span class="n">dist2</span><span class="p">,</span><span class="n">isFraud</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="s2">"Dist"</span><span class="p">,</span><span class="s2">"Values"</span><span class="p">,</span><span class="o">-</span><span class="n">isFraud</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Values</span><span class="p">,</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">stat_ecdf</span><span class="p">(</span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"step"</span><span class="p">,</span><span class="w"> 
            </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w"> 
            </span><span class="n">pad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">isFraud</span><span class="o">~</span><span class="n">Dist</span><span class="p">,</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Distance"</span><span class="p">,</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cumulative Frequency"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<figure>
  <img src="/img/Project/p4/fig4.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 4: Visualizing distance  </figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
We observe that, a majority of the transactions have missing distance values for dist2. However, the dist1 values are missing for 60% of the transactions. According to figure 4, only a quarter of transactions have distance values for dist1 approximately more than 200 for fraudulent transactions.  </span></p>

<h4 id="c1c14">C1~C14</h4>
<p><span style="font-family:Georgia; font-size:18px;">
The variables C1 to C14 denote counting, such as how many addresses are found to be associated with the payment card,etc. The actual meaning of the variable is masked. To analyze this variable, we can examine the pairwise correlation of the variables C1~C14.</span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### C1~C14 variables dataframe : counting, such as how many addresses are found to be associated with the payment card,etc.</span><span class="w">
</span><span class="n">c_vars_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">select</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">)[</span><span class="n">str_detect</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="s2">"^C[0-9]+"</span><span class="p">)])</span><span class="w">
</span><span class="c1"># Pairwise Correlation heatmap of C1~C14</span><span class="w">
</span><span class="n">cor</span><span class="p">(</span><span class="n">c_vars_df</span><span class="p">,</span><span class="w">
     </span><span class="n">use</span><span class="o">=</span><span class="s2">"pairwise.complete.obs"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">melt</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">Var1</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"C([0-9]+)"</span><span class="p">,</span><span class="s2">"\\1"</span><span class="p">,</span><span class="n">Var1</span><span class="p">)),</span><span class="w">
         </span><span class="n">Var2</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"C([0-9]+)"</span><span class="p">,</span><span class="s2">"\\1"</span><span class="p">,</span><span class="n">Var2</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">Var1</span><span class="p">),</span><span class="n">factor</span><span class="p">(</span><span class="n">Var2</span><span class="p">),</span><span class="n">fill</span><span class="o">=</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_tile</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_gradient2</span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#d7301f"</span><span class="p">,</span><span class="n">mid</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#045a8d"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"C"</span><span class="p">,</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_discrete</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"C"</span><span class="p">,</span><span class="n">x</span><span class="p">))</span><span class="w">
</span><span class="c1"># Redundant features among C1~C14</span><span class="w">
</span><span class="n">c_vars_drop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">c_vars_df</span><span class="p">)[</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">c_vars_df</span><span class="p">),</span><span class="s2">"C([1,3,5,13]$)"</span><span class="p">)]</span><span class="w">
</span><span class="c1"># Remove unwanted variables</span><span class="w">
</span><span class="n">rm</span><span class="p">(</span><span class="n">c_vars_df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig5.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 5: Visualizing Pairwise correlation for C1-C14  </figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
The heatmap in figure 5 illustrates the pairwise correlation between the C1~C14 variables. We see that, there is a strong correlation between many of the variables. Therefore, we consider the variables C1, C3, C5 and C13. We will exclude all other variables from our analysis.   </span></p>

<h4 id="d1d15">D1~D15</h4>
<p><span style="font-family:Georgia; font-size:18px;">
The variables D1 to D15 gives the timedelta, such as days between previous transaction, etc. We perform a similar approach as before and generate a pairwise correlation heatmap for the variables D1~D15.  Additionally, we eliminate the columns which have more than 85% missing data.  </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### D1 ~ D15 : timedelta, such as days between previous transaction, etc.</span><span class="w">
</span><span class="c1"># D1 ~ D15 variables dataframe</span><span class="w">
</span><span class="n">d_vars_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">)[</span><span class="n">str_detect</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="s2">"^D[0-9]+"</span><span class="p">)])</span><span class="w">
</span><span class="c1"># Pairwise Correlation heatmap of D1~D15</span><span class="w">
</span><span class="n">cor</span><span class="p">(</span><span class="n">d_vars_df</span><span class="p">,</span><span class="w">
    </span><span class="n">use</span><span class="o">=</span><span class="s2">"pairwise.complete.obs"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">melt</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">Var1</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"D([0-9]+)"</span><span class="p">,</span><span class="s2">"\\1"</span><span class="p">,</span><span class="n">Var1</span><span class="p">)),</span><span class="w">
         </span><span class="n">Var2</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"D([0-9]+)"</span><span class="p">,</span><span class="s2">"\\1"</span><span class="p">,</span><span class="n">Var2</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">Var1</span><span class="p">),</span><span class="n">factor</span><span class="p">(</span><span class="n">Var2</span><span class="p">),</span><span class="n">fill</span><span class="o">=</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_tile</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_gradient2</span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#d7301f"</span><span class="p">,</span><span class="n">mid</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#045a8d"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"D"</span><span class="p">,</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_discrete</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"D"</span><span class="p">,</span><span class="n">x</span><span class="p">))</span><span class="w">
</span><span class="c1"># Remove variables with more than 85% values missing </span><span class="w">
</span><span class="n">d_vars_missingvalues</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
  </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">colMeans</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">df</span><span class="p">))),</span><span class="w">
             </span><span class="n">missingPercent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colMeans</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"^D([0-9]+)"</span><span class="p">,</span><span class="n">Var</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">round</span><span class="p">(</span><span class="n">missingPercent</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.85</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">pull</span><span class="p">(</span><span class="n">Var</span><span class="p">)</span><span class="w">
</span><span class="c1"># Remove unwanted variables</span><span class="w">
</span><span class="n">rm</span><span class="p">(</span><span class="n">d_vars_df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<figure>
  <img src="/img/Project/p4/fig6.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 6: Visualizing pairwise correlation for D1-D15  </figcaption>
</figure>

<p>Figure 7: Visualizing pairwise correlation for Vesta engineered rich features</p>

<p><span style="font-family:Georgia; font-size:18px;">
The heatmap in figure 6 does not show a strong correlation between any of the variables. The variables with more than 85% of missing values will be dropped from analysis.  </span></p>

<h4 id="vxxx-vesta-engineered-rich-features">Vxxx Vesta engineered rich features</h4>
<p><span style="font-family:Georgia; font-size:18px;">
We then proceed to the Vesta engineered rich features Vxxx, that include ranking, counting, and other entity relations. We have a total of 339 features from V1~V339. We go ahead with generating a pairwise heatmap to check for correlation between the features. </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Vxxx: Vesta engineered rich features, including ranking, counting, and other entity relations.</span><span class="w">
</span><span class="c1"># Vxxx variables dataframe</span><span class="w">
</span><span class="n">vxxx_vars_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">)[</span><span class="n">str_detect</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="s2">"^V"</span><span class="p">)])</span><span class="w">
</span><span class="c1"># Visualizing pairwise correlation of Vxxx features using heatmap</span><span class="w">
</span><span class="n">cor</span><span class="p">(</span><span class="n">vxxx_vars_df</span><span class="p">,</span><span class="w">
    </span><span class="n">use</span><span class="o">=</span><span class="s2">"pairwise.complete.obs"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">melt</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">Var1</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"V([0-9]+)"</span><span class="p">,</span><span class="s2">"\\1"</span><span class="p">,</span><span class="n">Var1</span><span class="p">)),</span><span class="w">
         </span><span class="n">Var2</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"V([0-9]+)"</span><span class="p">,</span><span class="s2">"\\1"</span><span class="p">,</span><span class="n">Var2</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Var1</span><span class="p">,</span><span class="n">Var2</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_tile</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_gradient2</span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#d7301f"</span><span class="p">,</span><span class="n">mid</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#045a8d"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">339</span><span class="p">,</span><span class="m">10</span><span class="p">),</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"V"</span><span class="p">,</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">339</span><span class="p">,</span><span class="m">10</span><span class="p">),</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"V"</span><span class="p">,</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">))</span><span class="w">
</span><span class="c1"># Remove variables with more than 70% values missing </span><span class="w">
</span><span class="n">vxxx_vars_nomissingvalues</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
  </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">colMeans</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">df</span><span class="p">))),</span><span class="w">
             </span><span class="n">missingPercent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colMeans</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"^V([0-9]+)"</span><span class="p">,</span><span class="n">Var</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">round</span><span class="p">(</span><span class="n">missingPercent</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">0.7</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">pull</span><span class="p">(</span><span class="n">Var</span><span class="p">)</span><span class="w">
</span><span class="c1"># Principal component analysis of Vxxx features</span><span class="w">
</span><span class="n">pca_Vxxx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">prcomp</span><span class="p">(</span><span class="n">na.omit</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">all_of</span><span class="p">(</span><span class="n">vxxx_vars_nomissingvalues</span><span class="p">))),</span><span class="w"> </span><span class="n">center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="c1"># First 23 components explain much of the variability</span><span class="w">
</span><span class="c1">#summary(pca_Vxxx)$importance[,1:16]</span><span class="w">
</span><span class="c1"># Features dropped among Vxxx features</span><span class="w">
</span><span class="n">vxxx_vars_drop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">vxxx_vars_df</span><span class="p">)[</span><span class="o">!</span><span class="nf">names</span><span class="p">(</span><span class="n">vxxx_vars_df</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">vxxx_vars_nomissingvalues</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">16</span><span class="p">]]</span><span class="w">
</span><span class="c1"># Remove unwanted variables</span><span class="w">
</span><span class="n">rm</span><span class="p">(</span><span class="n">vxxx_vars_df</span><span class="p">,</span><span class="n">pca_Vxxx</span><span class="p">,</span><span class="n">vxxx_vars_nomissingvalues</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<figure>
  <img src="/img/Project/p4/fig7.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 7: Visualizing pairwise correlation for Vesta engineered rich features  </figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
Although, there is a strong correlation beween the Vxxx features, as seen in figure 7, it is quite ambiguous to separate each of the correlations. Instead, we use dimensionality reduction techniques like Principal Component Analysis, or PCA. The results of PCA shows that, the first 16 features account for more than 99% variance in the data. Hence, we include V1~V16 in our analysis and eliminate the others.  </span></p>

<h4 id="identity-information-id_01-id_11">Identity Information (id_01-id_11)</h4>

<p><span style="font-family:Georgia; font-size:18px;">
The variables id_01 to id_11 capture identity information of the transactions. Although, this is not available for all the transactions, we can analyse for patterns in available data. Additionally, we eliminate the features with more than 99% missing data.   </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### id_01 ~ id_11 :  Variables with more than 99% of the values as NA</span><span class="w">
</span><span class="n">missing_vars</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">colMeans</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">df</span><span class="p">))),</span><span class="w">
                           </span><span class="n">missingPercent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colMeans</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">missingPercent</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">0.99</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pull</span><span class="p">(</span><span class="n">Var</span><span class="p">)</span><span class="w">
</span><span class="c1"># id_01 ~ id_38 variables dataframevariables dataframe</span><span class="w">
</span><span class="n">id_vars_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">)[</span><span class="n">str_detect</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="s2">"^id_[0-9]+"</span><span class="p">)])</span><span class="w">
</span><span class="c1"># Remove variables with more than 99% values missing</span><span class="w">
</span><span class="n">numeric_id_vars_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">id_vars_df</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">11</span><span class="p">],</span><span class="o">-</span><span class="n">all_of</span><span class="p">(</span><span class="n">missing_vars</span><span class="p">))))</span><span class="w">
</span><span class="c1"># Pairwise Correlation heatmap of id_01~id11</span><span class="w">
</span><span class="n">cor</span><span class="p">(</span><span class="n">numeric_id_vars_df</span><span class="p">,</span><span class="w">
    </span><span class="n">use</span><span class="o">=</span><span class="s2">"pairwise.complete.obs"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">melt</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">Var1</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"id_([0-9]+)"</span><span class="p">,</span><span class="s2">"\\1"</span><span class="p">,</span><span class="n">Var1</span><span class="p">)),</span><span class="w">
         </span><span class="n">Var2</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"id_([0-9]+)"</span><span class="p">,</span><span class="s2">"\\1"</span><span class="p">,</span><span class="n">Var2</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">Var1</span><span class="p">),</span><span class="n">factor</span><span class="p">(</span><span class="n">Var2</span><span class="p">),</span><span class="n">fill</span><span class="o">=</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_tile</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_gradient2</span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#d7301f"</span><span class="p">,</span><span class="n">mid</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#045a8d"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"id_"</span><span class="p">,</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_discrete</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"id_"</span><span class="p">,</span><span class="n">x</span><span class="p">))</span><span class="w">
</span><span class="n">rm</span><span class="p">(</span><span class="n">numeric_id_vars_df</span><span class="p">,</span><span class="n">id_vars_df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<figure>
  <img src="/img/Project/p4/fig8.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 8: Visualizing pairwise correlation for numeric id variables  </figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
There is no strong correlation as per figure 8. Moreover, the analysis shows that, 9 variables have more than 99% of values missing. We will eliminate these from our analysis.  </span></p>

<h3 id="categorical-variables">Categorical Variables</h3>

<p><span style="font-family:Georgia; font-size:18px;">
There are 49 categorical predictor variables in our dataset. We examine each one of the categorical variables one by one in this section.  </span></p>

<h4 id="product-code">Product Code</h4>

<p><span style="font-family:Georgia; font-size:18px;">
The ProductCD indicates the product used in each transaction. We begin our analysis, to check if any specific product is more prone to fraudulent transactions. The following code estimates the fraction of transactions and transaction amount contributed by each of the products. The boxplot for each of the products depicts the distribution of each of the individual products.   </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### ProductCD : product code, the product for each transaction  </span><span class="w">
</span><span class="c1"># Fraudulent transactions vs legitimate transactions grouped by ProductCD</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">ProductCD</span><span class="p">,</span><span class="n">isFraud</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">num_txn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">data.frame</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_txn</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">num_txn</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProductCD</span><span class="p">,</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prop</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
           </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(),</span><span class="w">
           </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="w">
           </span><span class="n">color</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProductCD</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prop</span><span class="p">,</span><span class="w">
                </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">prop</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="s1">'%'</span><span class="p">)),</span><span class="w">
            </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(</span><span class="m">0.9</span><span class="p">),</span><span class="w"> 
            </span><span class="n">size</span><span class="o">=</span><span class="m">2.5</span><span class="p">,</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Product Code"</span><span class="p">,</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"% of Number of Transactions"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scales</span><span class="o">::</span><span class="n">percent</span><span class="p">,</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">),</span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"Fraud"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottom"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Total Transaction amount of Fraudulent transactions vs legitimate transactions grouped by ProductCD</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">ProductCD</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">Txn_amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">TransactionAmt</span><span class="p">)</span><span class="o">/</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProductCD</span><span class="p">,</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Txn_amount</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
           </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(),</span><span class="w">
           </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="w">
           </span><span class="n">color</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProductCD</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Txn_amount</span><span class="p">,</span><span class="w">
                </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">Txn_amount</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="s2">"$"</span><span class="p">)),</span><span class="w">
            </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(</span><span class="m">0.9</span><span class="p">),</span><span class="w"> 
            </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">-0.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">ProductCD</span><span class="w"> </span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">),</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"Fraud"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">"Total Transaction Amount (in Thousands)"</span><span class="p">,</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottom"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Distribution of Transaction amount of Fraudulent transactions vs legitimate transactions grouped by ProductCD</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProductCD</span><span class="p">,</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TransactionAmt</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_boxplot</span><span class="p">(</span><span class="n">outlier.colour</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w">
               </span><span class="n">outlier.shape</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w">
               </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.7</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">"Transaction Amount"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylim</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1500</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w">
                    </span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">),</span><span class="w">
                    </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottom"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig9.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 9: Visualizing Product Code  </figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
Although, the proportion of fraud transactions is dependant on the number of transactions in a particular product, product code is an essential feature of transaction and we therefore retain this feature for our analysis.</span></p>

<h4 id="payment-card-information">Payment Card Information</h4>

<p><span style="font-family:Georgia; font-size:18px;">
The payment card information includes 6 variables card1~card6. The information in these variable contain details such as card type, card category, issue bank, country, etc. We shall now examine an overview of these variables by the number of transactions and transaction amount in each category.  </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### card1 - card6 : payment card information, such as card type, card category, issue bank, country, etc.</span><span class="w">
</span><span class="c1"># Visualizing  variables Card 1, Card2 and Card3 and Card5 and associated number of transactions</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">card1</span><span class="p">,</span><span class="n">card2</span><span class="p">,</span><span class="n">card3</span><span class="p">,</span><span class="n">card5</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="s2">"Card"</span><span class="p">,</span><span class="s2">"Values"</span><span class="p">,</span><span class="o">-</span><span class="n">isFraud</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">Card</span><span class="p">,</span><span class="n">isFraud</span><span class="p">,</span><span class="n">Values</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">num_txn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Values</span><span class="p">,</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_txn</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">Card</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.7</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">,</span><span class="s2">"#8da0cb"</span><span class="p">,</span><span class="s2">"#ffd92f"</span><span class="p">,</span><span class="s2">"#bc80bd"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">Card</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">isFraud</span><span class="p">,</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)),</span><span class="w">
             </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="s2">"card1 values"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Number of Transactions"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Visualizing  card1, card2, card3 and card5 values and associated transaction amount</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">TransactionAmt</span><span class="p">,</span><span class="n">card1</span><span class="p">,</span><span class="n">card2</span><span class="p">,</span><span class="n">card3</span><span class="p">,</span><span class="n">card5</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="s2">"Card"</span><span class="p">,</span><span class="s2">"Values"</span><span class="p">,</span><span class="o">-</span><span class="n">isFraud</span><span class="p">,</span><span class="o">-</span><span class="n">TransactionAmt</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">Card</span><span class="p">,</span><span class="n">isFraud</span><span class="p">,</span><span class="n">Values</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">txn_amt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">TransactionAmt</span><span class="p">)</span><span class="o">/</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Values</span><span class="p">,</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">txn_amt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">Card</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.7</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">,</span><span class="s2">"#8da0cb"</span><span class="p">,</span><span class="s2">"#ffd92f"</span><span class="p">,</span><span class="s2">"#bc80bd"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">Card</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">isFraud</span><span class="p">,</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)),</span><span class="w">
             </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="s2">"card1 values"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Number of Transactions"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig10a.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
</figure>
<figure>
  <img src="/img/Project/p4/fig10b.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 10: Visualizing Card Information </figcaption>
</figure>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Visualizing variables card4 and card6 </span><span class="w">
</span><span class="c1"># Number of transactions for each Card type and network, grouped by transaction type(Fraudulent/legitimate)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">card4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">card4</span><span class="p">,</span><span class="w">
                                          </span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">card4</span><span class="p">)[</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">card4</span><span class="p">),</span><span class="w">
                                                                            </span><span class="s2">"visa|master|discover|amer"</span><span class="p">)],</span><span class="s2">"Others"</span><span class="p">),</span><span class="w">
                </span><span class="n">card6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">card6</span><span class="p">,</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">card6</span><span class="p">)[</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">card6</span><span class="p">),</span><span class="w">
                                    </span><span class="s2">"debit|credit"</span><span class="p">)],</span><span class="s2">"Others"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">card4</span><span class="p">,</span><span class="n">card6</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">num_txn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_txn</span><span class="p">,</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">card6</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">card6</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">card4</span><span class="w"> </span><span class="p">,</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">),</span><span class="w">
                                 </span><span class="n">card4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Other Networks"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Other \n Networks"</span><span class="p">,</span><span class="s2">"american express"</span><span class="o">=</span><span class="s2">"Amex"</span><span class="p">,</span><span class="s2">"discover"</span><span class="o">=</span><span class="s2">"Discover"</span><span class="p">,</span><span class="s2">"mastercard"</span><span class="o">=</span><span class="s2">"MasterCard"</span><span class="p">,</span><span class="s2">"visa"</span><span class="o">=</span><span class="s2">"Visa"</span><span class="p">)),</span><span class="w">
             </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">,</span><span class="s2">"#8da0cb"</span><span class="p">,</span><span class="s2">"#ffd92f"</span><span class="p">,</span><span class="s2">"#bc80bd"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">"Number of Transactions"</span><span class="p">,</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Card Type"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">,</span><span class="w">
        </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">))</span><span class="w">
</span><span class="c1"># Total transaction amount for each Card type and network, grouped by transaction type(Fraudulent/legitimate)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">card4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">card4</span><span class="p">,</span><span class="w">
                                          </span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">card4</span><span class="p">)[</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">card4</span><span class="p">),</span><span class="w">
                                                                       </span><span class="s2">"visa|master|discover|amer"</span><span class="p">)],</span><span class="s2">"Others"</span><span class="p">),</span><span class="w">
                </span><span class="n">card6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">card6</span><span class="p">,</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">card6</span><span class="p">)[</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">card6</span><span class="p">),</span><span class="w">
                                                                             </span><span class="s2">"debit|credit"</span><span class="p">)],</span><span class="s2">"Others"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">card4</span><span class="p">,</span><span class="n">card6</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">Txn_amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">TransactionAmt</span><span class="p">)</span><span class="o">/</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Txn_amount</span><span class="p">,</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">card6</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">card6</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="c1">#position=position_dodge()</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">card4</span><span class="w"> </span><span class="p">,</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">),</span><span class="w">
                                 </span><span class="n">card4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Other Networks"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Other Networks"</span><span class="p">,</span><span class="s2">"american express"</span><span class="o">=</span><span class="s2">"Amex"</span><span class="p">,</span><span class="s2">"discover"</span><span class="o">=</span><span class="s2">"Discover"</span><span class="p">,</span><span class="s2">"mastercard"</span><span class="o">=</span><span class="s2">"MasterCard"</span><span class="p">,</span><span class="s2">"visa"</span><span class="o">=</span><span class="s2">"Visa"</span><span class="p">)),</span><span class="w">
             </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">"Transaction Amount (in Thousands)"</span><span class="p">,</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Card Type"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">,</span><span class="s2">"#8da0cb"</span><span class="p">,</span><span class="s2">"#ffd92f"</span><span class="p">,</span><span class="s2">"#bc80bd"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">,</span><span class="w">
        </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig11a.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
</figure>
<figure>
  <img src="/img/Project/p4/fig11b.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 11: Visualizing Card Information </figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
The figure shows the number of transactions and transaction amount in each of card4 and card6 categories. For example, even though the majority of legitimate transactions are on debit card in MasterCard, the number of credit card fraud transactions exceed those of debit card transations. Payment card information is quite an essential detail with respect to predicting fraud transactions. We retain all these features.  </span></p>

<h4 id="match">Match</h4>

<p><span style="font-family:Georgia; font-size:18px;">
We then proceed to analyze the match variables M1~M9. These features denote match, such as names on card and address, etc. The number of transactions and total amount associated with each kind of value can be viewed in the plots below.<br />
Except for M4 variables, all other match variables are of boolean type. We will visualize both of them separately to look for patterns to identify transactions as fraud.  </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### M1 ~ M9 (logical) : match, such as names on card and address, etc.</span><span class="w">
</span><span class="c1"># Visualizing M1~ M9 values and associated number of transactions</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">M1</span><span class="o">:</span><span class="n">M3</span><span class="p">,</span><span class="n">M5</span><span class="o">:</span><span class="n">M9</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="s2">"Var"</span><span class="p">,</span><span class="s2">"values"</span><span class="p">,</span><span class="o">-</span><span class="n">isFraud</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">Var</span><span class="p">,</span><span class="n">isFraud</span><span class="p">,</span><span class="n">values</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">num_txn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Var</span><span class="p">,</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_txn</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">Var</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
           </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.65</span><span class="p">,</span><span class="w">
           </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position_dodge</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">type</span><span class="o">=</span><span class="s2">"qual"</span><span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">isFraud</span><span class="p">,</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)),</span><span class="w">
             </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Number of Transactions"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottom"</span><span class="p">,</span><span class="w">
        </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">axis.ticks.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w">
</span><span class="c1"># Visualizing M1~M9 values and associated total transaction amount</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">TransactionAmt</span><span class="p">,</span><span class="n">isFraud</span><span class="p">,</span><span class="n">M1</span><span class="o">:</span><span class="n">M3</span><span class="p">,</span><span class="n">M5</span><span class="o">:</span><span class="n">M9</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="s2">"Var"</span><span class="p">,</span><span class="s2">"values"</span><span class="p">,</span><span class="o">-</span><span class="n">TransactionAmt</span><span class="p">,</span><span class="o">-</span><span class="n">isFraud</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">Var</span><span class="p">,</span><span class="n">isFraud</span><span class="p">,</span><span class="n">values</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">txn_amt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">TransactionAmt</span><span class="p">)</span><span class="o">/</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Var</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">txn_amt</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">Var</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">type</span><span class="o">=</span><span class="s2">"qual"</span><span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
           </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.65</span><span class="p">,</span><span class="w">
           </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position_dodge</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">isFraud</span><span class="p">,</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)),</span><span class="w">
             </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Total Transaction Amount (in Thousands)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottom"</span><span class="p">)</span><span class="w">
</span><span class="c1">### M4 (Character variable) </span><span class="w">
</span><span class="c1"># Visualizing M4 values and associated number of transactions </span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">M4</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">M4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">M4</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">M4</span><span class="p">),</span><span class="s2">"(Blank)"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">M4</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">num_txn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M4</span><span class="p">,</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_txn</span><span class="p">,</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="n">fill</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">M4</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
           </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position_dodge</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">type</span><span class="o">=</span><span class="s2">"qual"</span><span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)),</span><span class="w">
             </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="s2">"M4 values"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Number of Transactions"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Visualizing M4 values and associated total transaction amount</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">TransactionAmt</span><span class="p">,</span><span class="n">isFraud</span><span class="p">,</span><span class="n">M4</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">M4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">M4</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">M4</span><span class="p">),</span><span class="s2">"(Blank)"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">M4</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">txn_amt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">TransactionAmt</span><span class="p">)</span><span class="o">/</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M4</span><span class="p">,</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">txn_amt</span><span class="p">,</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="n">fill</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">M4</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
           </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position_dodge</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">type</span><span class="o">=</span><span class="s2">"qual"</span><span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)),</span><span class="w">
             </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="s2">"M4 values"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Total Transaction Amount (in Thousands)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig12.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 12: Visualizing Match variable </figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
There is variance accounted by each of these features. We retain all these features for modeling.</span></p>

<h4 id="address">Address</h4>
<p><span style="font-family:Georgia; font-size:18px;">
The address details are given by addr1 and addr2 columns. We examine addr1 and addr2 separately to look for discernible patterns.</span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### addr1 and addr2 : Address</span><span class="w">
</span><span class="c1"># Visualizing addr1 values and associated number of transactions</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">addr1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">num_txn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">addr1</span><span class="p">,</span><span class="n">num_txn</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vars</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="s2">"addr1 values"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Number of Transactions"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Visualizing addr1 values and associated total transaction amount</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">TransactionAmt</span><span class="p">,</span><span class="n">addr1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">txn_amt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">TransactionAmt</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">addr1</span><span class="p">,</span><span class="n">txn_amt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vars</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="s2">"addr1 values"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Total Transaction Amount (in Thousands)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig13a.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
</figure>

<figure>
  <img src="/img/Project/p4/fig13b.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 13: Visualizing addr1</figcaption>
</figure>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Visualizing addr2 values and associated number of transactions</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">addr2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">num_txn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">addr2</span><span class="p">,</span><span class="n">num_txn</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="m">87</span><span class="p">,</span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"longdash"</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="m">87</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="m">-500</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="m">87</span><span class="p">,</span><span class="n">hjust</span><span class="o">=</span><span class="m">1.5</span><span class="p">),</span><span class="w">
            </span><span class="n">size</span><span class="o">=</span><span class="m">2.5</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="s2">"Courier"</span><span class="p">,</span><span class="w"> </span><span class="n">fontface</span><span class="o">=</span><span class="s2">"italic"</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkgrey"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vars</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="s2">"addr2 values"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Number of Transactions"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Visualizing addr2 values and associated total transaction amount</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">TransactionAmt</span><span class="p">,</span><span class="n">addr2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">txn_amt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">TransactionAmt</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">addr2</span><span class="p">,</span><span class="n">txn_amt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="m">87</span><span class="p">,</span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"longdash"</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="m">87</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="m">-500</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="m">87</span><span class="p">,</span><span class="n">hjust</span><span class="o">=</span><span class="m">1.5</span><span class="p">),</span><span class="w">
            </span><span class="n">size</span><span class="o">=</span><span class="m">2.5</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="s2">"Courier"</span><span class="p">,</span><span class="w"> </span><span class="n">fontface</span><span class="o">=</span><span class="s2">"italic"</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkgrey"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vars</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="s2">"addr2 values"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Total Transaction Amount (in Thousands)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig14a.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
</figure>

<figure>
  <img src="/img/Project/p4/fig14b.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 14: Visualizing addr2</figcaption>
</figure>

<h4 id="purchaser-email-domain">Purchaser email domain</h4>

<p><span style="font-family:Georgia; font-size:18px;">
The purchaser email domain is given by P_emaildomain. We merge the domains appropriately to ease our analysis with domains. We merge all microsoft, yahoo, icloud, aol, gmail and .net(Networking) domains separately and categorize all other domains as “Others”. </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### P_emaildomain: purchaser email domain</span><span class="w">
</span><span class="c1"># Visualizing purchaser email domain of approximately 99% of the transactions.</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"live"</span><span class="p">,</span><span class="s2">"outlook"</span><span class="p">,</span><span class="s2">"hotmail"</span><span class="p">,</span><span class="s2">"msn"</span><span class="p">),</span><span class="s2">"Microsoft"</span><span class="p">),</span><span class="w">
                </span><span class="c1"># Replaces 8 Yahoo domains </span><span class="w">
                </span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"yahoo"</span><span class="p">,</span><span class="s2">"ymail"</span><span class="p">),</span><span class="s2">"Yahoo"</span><span class="p">),</span><span class="w">
                </span><span class="c1"># Replaces 3 icloud domains </span><span class="w">
                </span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"me.com"</span><span class="p">,</span><span class="s2">"mac.com"</span><span class="p">,</span><span class="s2">"icloud.com"</span><span class="p">),</span><span class="s2">"iCloud"</span><span class="p">),</span><span class="w">
                </span><span class="c1"># Replaces 2 AOL domains </span><span class="w">
                </span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"aol"</span><span class="p">,</span><span class="s2">"aim"</span><span class="p">),</span><span class="s2">"AOL"</span><span class="p">),</span><span class="w">
                </span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"gmail.com"</span><span class="p">,</span><span class="s2">"gmail"</span><span class="p">),</span><span class="s2">"Gmail"</span><span class="p">),</span><span class="w">
                </span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">".net"</span><span class="p">),</span><span class="s2">"NetworkingDomains"</span><span class="p">),</span><span class="w">
                </span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">P_emaildomain</span><span class="p">)[</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">P_emaildomain</span><span class="p">),</span><span class="w">
                                                                                                          </span><span class="s2">"Gmail|Yahoo|Networking|Microsoft|AOL|iCloud"</span><span class="p">)]</span><span class="w">
                                                  </span><span class="p">,</span><span class="s2">"Others"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">P_emaildomain</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">num_txn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">reorder</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="n">num_txn</span><span class="p">),</span><span class="n">num_txn</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="s2">"Purchaser email domain"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Number of transactions"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">,</span><span class="w">
        </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig15.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 15: Visualizing Purchaser Email Domain </figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
The figure shows the number of legitimate transactions for yahoo exceeds all others except gmail. But, the number of fraud transactions from microsoft exceeds that of yahoo. There are some patterns which need more analysis and hence we retain the variable in our model.  </span></p>

<h4 id="recepient-email-domain">Recepient email domain</h4>

<p><span style="font-family:Georgia; font-size:18px;">
The recepient email domain is given by R_emaildomain. Similar to the purchaser email domain, we merge the domains appropriately to ease our analysis with domains. We merge all microsoft, yahoo, icloud, aol, gmail and .net(Networking) domains separately and categorize all other domains as “Others”.   </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### R_emaildomain : recipient email domain</span><span class="w">
</span><span class="c1"># Visualizing recipient email domain of approximately 99% of the transactions.</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"live"</span><span class="p">,</span><span class="s2">"outlook"</span><span class="p">,</span><span class="s2">"hotmail"</span><span class="p">,</span><span class="s2">"msn"</span><span class="p">),</span><span class="s2">"Microsoft"</span><span class="p">),</span><span class="w">
                </span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"yahoo"</span><span class="p">,</span><span class="s2">"ymail"</span><span class="p">),</span><span class="s2">"Yahoo"</span><span class="p">),</span><span class="w">
                </span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"me.com"</span><span class="p">,</span><span class="s2">"mac.com"</span><span class="p">,</span><span class="s2">"icloud.com"</span><span class="p">),</span><span class="s2">"iCloud"</span><span class="p">),</span><span class="w">
                </span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"aol"</span><span class="p">,</span><span class="s2">"aim"</span><span class="p">),</span><span class="s2">"AOL"</span><span class="p">),</span><span class="w">
                </span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"gmail.com"</span><span class="p">,</span><span class="s2">"gmail"</span><span class="p">),</span><span class="s2">"Gmail"</span><span class="p">),</span><span class="w">
                </span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">".net"</span><span class="p">),</span><span class="s2">"NetworkingDomains"</span><span class="p">),</span><span class="w">
                </span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> 
                  </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="w">
                                    </span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">R_emaildomain</span><span class="p">)[</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">R_emaildomain</span><span class="p">),</span><span class="w">
                                                                              </span><span class="s2">"Gmail|Yahoo|Networking|Microsoft|AOL|iCloud"</span><span class="p">)],</span><span class="s2">"Others"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">R_emaildomain</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">num_txn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">reorder</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="n">num_txn</span><span class="p">),</span><span class="n">num_txn</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="w">
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="s2">"Recepient email domain"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Number of transactions"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">,</span><span class="w">
        </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig16.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 16: Visualizing Recepient Email Domain</figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
We see similar patters with recipient email domain as well. Even though number of legitimate transactions are higher in aol when compared to icloud, the latter has higher fraud transactions.  </span></p>

<h4 id="device-type">Device Type</h4>

<p><span style="font-family:Georgia; font-size:18px;">
The variable DeviceType gives the type of device used for the online transaction. We shall examine the number of transactions in each category.</span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Device Type : type of device used for transaction (mobile/desktop/Unknown)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">DeviceType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">DeviceType</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">DeviceType</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">isFraud</span><span class="p">,</span><span class="n">DeviceType</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">num_txn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_txn</span><span class="p">,</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DeviceType</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">isFraud</span><span class="p">),</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">"Number of Transactions"</span><span class="p">,</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Device Type"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig17.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 17: Count plot of Device Type</figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
Although the number of legitimate transactions using desktop exceeds that of mobile, the number of fraud transactions using mobile is slightly higher than that of desktop. We shall retain the variable for inclusion in our model.</span></p>

<h4 id="device-info">Device Info</h4>
<p><span style="font-family:Georgia; font-size:18px;">
The device information of the device on which the transaction was made can is available in the DeviceInfo column. We analyse the device information of devices that have more than 100 transactions.  </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Device Info </span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">DeviceType</span><span class="p">,</span><span class="n">DeviceInfo</span><span class="p">,</span><span class="n">isFraud</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">DeviceInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">DeviceInfo</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"SM"</span><span class="p">,</span><span class="s2">"SAMSUNG"</span><span class="p">,</span><span class="s2">"samsung"</span><span class="p">),</span><span class="s2">"Samsung"</span><span class="p">),</span><span class="w">
                </span><span class="n">DeviceInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">DeviceInfo</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"HTC"</span><span class="p">),</span><span class="s2">"HTC"</span><span class="p">),</span><span class="w">
                </span><span class="n">DeviceInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">DeviceInfo</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Moto"</span><span class="p">,</span><span class="s2">"Motorola"</span><span class="p">,</span><span class="s2">"MOTOROLA"</span><span class="p">,</span><span class="s2">"XT1635"</span><span class="p">),</span><span class="s2">"Motorola"</span><span class="p">),</span><span class="w">
                </span><span class="n">DeviceInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">DeviceInfo</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"HUAWEI"</span><span class="p">,</span><span class="s2">"Huawei"</span><span class="p">,</span><span class="s2">"hi6210"</span><span class="p">),</span><span class="s2">"Huawei"</span><span class="p">),</span><span class="w">
                </span><span class="n">DeviceInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">DeviceInfo</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"LG"</span><span class="p">),</span><span class="s2">"LG"</span><span class="p">),</span><span class="w">
                </span><span class="n">DeviceInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">DeviceInfo</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">DeviceInfo</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">DeviceType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">DeviceType</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">DeviceType</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">DeviceType</span><span class="p">,</span><span class="n">DeviceInfo</span><span class="p">,</span><span class="n">isFraud</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="o">-</span><span class="n">num</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">num</span><span class="o">&gt;</span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num</span><span class="p">,</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DeviceInfo</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">isFraud</span><span class="o">~</span><span class="n">DeviceType</span><span class="p">,</span><span class="w"> 
             </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free"</span><span class="p">,</span><span class="w">
             </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">isFraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="o">=</span><span class="w"> </span><span class="s2">"Legitimate"</span><span class="p">,</span><span class="s2">"1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fraud"</span><span class="p">),</span><span class="w">
                                 </span><span class="n">DeviceType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"desktop"</span><span class="o">=</span><span class="s2">"Desktop"</span><span class="p">,</span><span class="s2">"mobile"</span><span class="o">=</span><span class="s2">"Mobile"</span><span class="p">,</span><span class="s2">"Unknown"</span><span class="o">=</span><span class="s2">"Unknown"</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="s2">"#fc8d62"</span><span class="p">,</span><span class="s2">"#8da0cb"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">"Number of Transactions"</span><span class="p">,</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Device Information"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">,</span><span class="w">
        </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig18.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 18: Count plot of Device info (number of transactions &gt; 100) </figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
There are visible patterns in the visualization above and hence we use this variable in our model.  </span></p>

<h4 id="identity-information-id_12id_38">Identity Information (id_12~id_38)</h4>

<p><span style="font-family:Georgia; font-size:18px;">
The identity information available in id12~id38 contain information regarding the device where transaction was made. For example : id_30 gives the OS version, id_31 gives the browser version, id_33 gives the resolution of the device to name a few. We retain all these variables, since they give further details of the transaction.</span></p>

<h2 id="data-preprocessing">Data Preprocessing</h2>

<p><span style="font-family:Georgia; font-size:18px;">
This stage involves various data preprocessing tasks like handling missing data, encoding categorical data as numerical and imputing missing values.</span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#################################################</span><span class="w">
</span><span class="c1">##### Feature Selection &amp; Imputing missing data</span><span class="w">
</span><span class="c1">#################################################</span><span class="w">
</span><span class="c1"># 434 Features in original dataset </span><span class="w">
</span><span class="c1">##### Initial Feature Selection by EDA</span><span class="w">
</span><span class="n">eliminated_features</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">c_vars_drop</span><span class="p">,</span><span class="n">d_vars_missingvalues</span><span class="p">,</span><span class="n">vxxx_vars_drop</span><span class="p">,</span><span class="n">missing_vars</span><span class="p">)</span><span class="w">
</span><span class="n">rm</span><span class="p">(</span><span class="n">c_vars_drop</span><span class="p">,</span><span class="n">d_vars_missingvalues</span><span class="p">,</span><span class="n">vxxx_vars_drop</span><span class="p">,</span><span class="n">missing_vars</span><span class="p">)</span><span class="w">
</span><span class="c1">##### Feature Engineering : Label Encoding and One-hot encoding</span><span class="w">
</span><span class="c1"># This function encodes the dataset and imputes necessary missing values</span><span class="w">
</span><span class="n">feature_engg_fraud_det</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">temp</span><span class="p">){</span><span class="w">
  </span><span class="c1"># Eliminated 350 variables after EDA; Remaining 84 variables</span><span class="w">
  </span><span class="n">numeric_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="o">-</span><span class="n">all_of</span><span class="p">(</span><span class="n">eliminated_features</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select_if</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">)</span><span class="w">  </span><span class="c1">#  Numeric vectors</span><span class="w">
  </span><span class="n">char_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="o">-</span><span class="n">all_of</span><span class="p">(</span><span class="n">eliminated_features</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select_if</span><span class="p">(</span><span class="n">is.character</span><span class="p">)</span><span class="w">   </span><span class="c1">#  Character vectors</span><span class="w">
  </span><span class="n">logical_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="o">-</span><span class="n">all_of</span><span class="p">(</span><span class="n">eliminated_features</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select_if</span><span class="p">(</span><span class="n">is.logical</span><span class="p">)</span><span class="w"> </span><span class="c1"># 12 Logical vectors</span><span class="w">
  
</span><span class="c1"># Merging email domains, card values and imputing missing categorical values</span><span class="w">
</span><span class="n">char_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">char_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
              </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">card6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">card6</span><span class="p">,</span><span class="w">
                                                      </span><span class="n">unique</span><span class="p">(</span><span class="n">char_df</span><span class="o">$</span><span class="n">card6</span><span class="p">)[</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">char_df</span><span class="o">$</span><span class="n">card6</span><span class="p">),</span><span class="w">
                                                                            </span><span class="s2">"debit|credit"</span><span class="p">)],</span><span class="s2">"Others"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
              </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">card4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">card4</span><span class="p">,</span><span class="w">
                                                      </span><span class="n">unique</span><span class="p">(</span><span class="n">char_df</span><span class="o">$</span><span class="n">card4</span><span class="p">)[</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">char_df</span><span class="o">$</span><span class="n">card4</span><span class="p">),</span><span class="w">
                                                                                        </span><span class="s2">"visa|master|discover|amer"</span><span class="p">)],</span><span class="w">
                            </span><span class="s2">"Others"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
              </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="w">
                                                              </span><span class="nf">c</span><span class="p">(</span><span class="s2">"live"</span><span class="p">,</span><span class="s2">"outlook"</span><span class="p">,</span><span class="s2">"hotmail"</span><span class="p">,</span><span class="s2">"msn"</span><span class="p">),</span><span class="w">
                                                              </span><span class="s2">"Microsoft"</span><span class="p">),</span><span class="w">
                           </span><span class="c1"># Replaces Yahoo domains </span><span class="w">
                            </span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="w">
                                                  </span><span class="nf">c</span><span class="p">(</span><span class="s2">"yahoo"</span><span class="p">,</span><span class="s2">"ymail"</span><span class="p">),</span><span class="w">
                                                  </span><span class="s2">"Yahoo"</span><span class="p">),</span><span class="w">
                           </span><span class="c1"># Replaces icloud domains </span><span class="w">
                           </span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"me.com"</span><span class="p">,</span><span class="s2">"mac.com"</span><span class="p">,</span><span class="s2">"icloud.com"</span><span class="p">),</span><span class="s2">"iCloud"</span><span class="p">),</span><span class="w">
                           </span><span class="c1"># Replaces AOL domains </span><span class="w">
                           </span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="w">
                                                             </span><span class="nf">c</span><span class="p">(</span><span class="s2">"aol"</span><span class="p">,</span><span class="s2">"aim"</span><span class="p">),</span><span class="w">
                                                             </span><span class="s2">"AOL"</span><span class="p">),</span><span class="w">
                           </span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="w">
                                                             </span><span class="nf">c</span><span class="p">(</span><span class="s2">"gmail.com"</span><span class="p">,</span><span class="s2">"gmail"</span><span class="p">),</span><span class="w">
                                                             </span><span class="s2">"Gmail"</span><span class="p">),</span><span class="w">
                           </span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="w">
                                                             </span><span class="nf">c</span><span class="p">(</span><span class="s2">".net"</span><span class="p">),</span><span class="w">
                                                             </span><span class="s2">"NetworkingDomains"</span><span class="p">),</span><span class="w">
                           </span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="w">
                                                             </span><span class="n">unique</span><span class="p">(</span><span class="n">char_df</span><span class="o">$</span><span class="n">P_emaildomain</span><span class="p">)[</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">char_df</span><span class="o">$</span><span class="n">P_emaildomain</span><span class="p">),</span><span class="w">
                                                                                                       </span><span class="s2">"Gmail|Yahoo|Networking|Microsoft|AOL|iCloud"</span><span class="p">)]</span><span class="w">
                                                             </span><span class="p">,</span><span class="s2">"Others"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
             </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="w">
                                                             </span><span class="nf">c</span><span class="p">(</span><span class="s2">"live"</span><span class="p">,</span><span class="s2">"outlook"</span><span class="p">,</span><span class="s2">"hotmail"</span><span class="p">,</span><span class="s2">"msn"</span><span class="p">),</span><span class="w">
                                                             </span><span class="s2">"Microsoft"</span><span class="p">),</span><span class="w">
                </span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="w">
                                                  </span><span class="nf">c</span><span class="p">(</span><span class="s2">"yahoo"</span><span class="p">,</span><span class="s2">"ymail"</span><span class="p">),</span><span class="w">
                                                  </span><span class="s2">"Yahoo"</span><span class="p">),</span><span class="w">
                </span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="w">
                                                  </span><span class="nf">c</span><span class="p">(</span><span class="s2">"me.com"</span><span class="p">,</span><span class="s2">"mac.com"</span><span class="p">,</span><span class="s2">"icloud.com"</span><span class="p">),</span><span class="w">
                                                  </span><span class="s2">"iCloud"</span><span class="p">),</span><span class="w">
                </span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="w">
                                                  </span><span class="nf">c</span><span class="p">(</span><span class="s2">"aol"</span><span class="p">,</span><span class="s2">"aim"</span><span class="p">),</span><span class="w">
                                                  </span><span class="s2">"AOL"</span><span class="p">),</span><span class="w">
                </span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="w">
                                                  </span><span class="nf">c</span><span class="p">(</span><span class="s2">"gmail.com"</span><span class="p">,</span><span class="s2">"gmail"</span><span class="p">),</span><span class="w">
                                                  </span><span class="s2">"Gmail"</span><span class="p">),</span><span class="w">
                </span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="w">
                                                  </span><span class="nf">c</span><span class="p">(</span><span class="s2">".net"</span><span class="p">),</span><span class="w">
                                                  </span><span class="s2">"NetworkingDomains"</span><span class="p">),</span><span class="w">
                </span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_columnval</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="w">
                                                  </span><span class="n">unique</span><span class="p">(</span><span class="n">char_df</span><span class="o">$</span><span class="n">R_emaildomain</span><span class="p">)[</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">char_df</span><span class="o">$</span><span class="n">R_emaildomain</span><span class="p">),</span><span class="w">
                                                                                                          </span><span class="s2">"Gmail|Yahoo|Networking|Microsoft|AOL|iCloud"</span><span class="p">)]</span><span class="w">
                                                  </span><span class="p">,</span><span class="s2">"Others"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
             </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">DeviceType</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">replace</span><span class="p">(</span><span class="n">DeviceType</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">DeviceType</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">DeviceInfo</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">replace</span><span class="p">(</span><span class="n">DeviceInfo</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">DeviceInfo</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">card4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">card4</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">card4</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">card6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">card6</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">card6</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">P_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">P_emaildomain</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">R_emaildomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">R_emaildomain</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">M4</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">replace</span><span class="p">(</span><span class="n">M4</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">M4</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">id_12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">id_12</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">id_12</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">id_15</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">id_15</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">id_15</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">id_16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">id_16</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">id_16</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">id_28</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">id_28</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">id_28</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">id_29</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">id_29</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">id_29</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">id_30</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">id_30</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">id_30</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">id_31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">id_31</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">id_31</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">),</span><span class="w">
                           </span><span class="n">id_34</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">id_34</span><span class="p">,</span><span class="nf">is.na</span><span class="p">(</span><span class="n">id_34</span><span class="p">),</span><span class="s2">"Unknown"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Dropping resolution column</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">id_33</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Binding columns of the dataset :  106 variables</span><span class="w">
  </span><span class="n">temp_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
    </span><span class="c1"># 5 character vectors encoded as 28 one-hot encoded variables</span><span class="w">
    </span><span class="n">cbind</span><span class="p">(</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">char_df</span><span class="p">)[</span><span class="n">str_detect</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">char_df</span><span class="p">),</span><span class="w">
                                                         </span><span class="s2">"emaildomain|card|Product"</span><span class="p">)],</span><span class="w">
                               </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">one_hot_encoding</span><span class="p">(</span><span class="n">char_df</span><span class="p">,</span><span class="n">x</span><span class="p">))),</span><span class="w">
          </span><span class="c1"># 11 character variables encoded with label encoding to 11 variables</span><span class="w">
          </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">char_df</span><span class="p">)[</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">char_df</span><span class="p">),</span><span class="w">
                                                          </span><span class="s2">"emaildomain|card|Product"</span><span class="p">)],</span><span class="w">
                               </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">label_encoding</span><span class="p">(</span><span class="n">char_df</span><span class="p">,</span><span class="n">x</span><span class="p">))),</span><span class="w">
          </span><span class="c1"># 12 logical vectors encoded as 12 numeric encoding of logical variables</span><span class="w">
          </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">logical_df</span><span class="p">),</span><span class="w"> 
                               </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">logical_df</span><span class="p">[[</span><span class="n">x</span><span class="p">]]))),</span><span class="w">
          </span><span class="c1"># 55 numeric variables </span><span class="w">
          </span><span class="n">numeric_df</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># Imputing numerical NA as -999</span><span class="w">
  </span><span class="n">temp_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate_if</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="o">~</span><span class="n">replace_na</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="m">-999</span><span class="p">)))</span><span class="w">
  
  </span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="n">temp_df</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p><span style="font-family:Georgia; font-size:18px;">
We then create a 90/10 train-test split of the df dataset for our model evaluation purposes. The model is created and trained in the train set and tested in the test set. This is called the prototyping phase that revolves around model selection, which requires measuring the AUC of plausible candidate models. When we are satisfied with the selected model type and hyperparameters, the last step of the prototyping phase is to train a new model on the entire df dataset set using the best hyperparameters found. The model is then validated on data we had put aside, the validation set. This gives us an estimate of the generalization error.i.e how well our model generalizes to new data. </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#### Create train set, test set (Imbalanced)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">feature_engg_fraud_det</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> 
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">1234</span><span class="p">,</span><span class="w"> </span><span class="n">sample.kind</span><span class="o">=</span><span class="s2">"Rounding"</span><span class="p">)</span><span class="w"> 
</span><span class="c1"># Create train set and test set</span><span class="w">
</span><span class="n">test_index</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">isFraud</span><span class="p">,</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">imbal_train_set</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="o">!</span><span class="n">row.names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">test_index</span><span class="p">,]</span><span class="w">
</span><span class="n">imbal_test_set</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="n">row.names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">test_index</span><span class="p">,]</span><span class="w">
</span><span class="c1"># Remove unwanted variables</span><span class="w">
</span><span class="n">rm</span><span class="p">(</span><span class="n">test_index</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="dealing-with-imbalanced-classes">Dealing with Imbalanced Classes</h2>
<p><span style="font-family:Georgia; font-size:18px;">
We previously discussed the effects of imbalanced data on our machine learning algorithms. Algorithms tend to overfit the data and classify all the transactions as legitimate and fail to discern patterns in the fraudulent transactions. However, there are methods to mitigate this and balance the data before feeding it to the models. 
We can achieve balanced classes by downsampling the majority class or oversampling the minority class.
Although, with random undersampling method there is a loss in information of the non-fraud transactions, it is optimal method with regards to computational efficiency. Oversampling the minority class can be achieved using Synthetic Minority Oversampling Technique, or SMOTE. With our current dataset, deploying SMOTE to balance the dataset needs excessive computational resources. 
Therefore, we proceed with random downsampling. In this method, the random samples are chosen from majority class and all minority class transactions in the dataset is retained.</span></p>

<h2 id="classification-models">Classification Models</h2>

<h3 id="bagged-classification-and-regression-trees-bagged-cart">Bagged Classification and Regression Trees (Bagged CART)</h3>
<p><span style="font-family:Georgia; font-size:18px;">
The first modeling technique chosen for the fraud detection dataset is the bagged classification and regression trees, or bagged CART. The bagging refers to the bootstrap aggregation of CART. Bagging is a very powerful ensemble method used for minimizing the variance in algorithms with high variance. One of the algorithms with high variance is the decision tree or CART. We use the method treebag that implements bagging technique from the ipred package. We use nbagg to control the number of bootstrap replications. Although, bagged CART is efficient and powerful, they are less desired if the data is correlated. Additionally, it tends to become computationally intense with an increase in the number of bootstrap samples. 
Therefore, we proceed to examine better techniques to overcome the observed drawbacks of bagged CART.</span></p>

<h3 id="random-forest">Random Forest</h3>
<p><span style="font-family:Georgia; font-size:18px;">
Random forests build an ensemble of deep independent trees to improve the predictive performance. Random forests are an improvement over bagged decision trees. The fundamental principle behind random forests are same as that of decision trees. They help to minimize the tree correlation by randomly picking the bootstrapped samples. The algorithm performs split-variable randomization where each time a split is to be performed and the search for the split variable is controlled by the mtry parameter. The default value of mtry is $\sqrt{p}$ for classification model.  </span></p>

<h3 id="extreme-gradient-boostingxgboost">eXtreme Gradient Boosting(XGBOOST)</h3>
<p><span style="font-family:Georgia; font-size:18px;">
Gradient Boosting Techniques are extremely popular machine learning algorithms and have proven successful across various domains. Gradient Boosting Machines(GBMs) build an ensemble of shallow trees in sequence, with each tree learning from the previous and are highly efficient, flexible and portable.</span></p>

<h1 id="results">Results</h1>
<p><span style="font-family:Georgia; font-size:18px;">
This section presents the code and results of the models discussed in the previous section. We will measure AUC for each of the models discussed above. The trainControl function is used to set the parameters to control how models are created. The models we chose in the previous section will be used along with these parameters. We will use repeated cross validation technique with 5-fold cross validation and the sampling technique used is the random down sampling technique. The classProbs is set to TRUE to enable the models to compute class probabilities, so that, AUC can be estimated.  </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Computational control parameters for train function</span><span class="w">
</span><span class="n">fitControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trainControl</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"repeatedcv"</span><span class="p">,</span><span class="w"> </span><span class="c1"># Repeated Cross validation </span><span class="w">
                          </span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w">  </span><span class="c1">#  controls the number of folds in K-fold cross-validation</span><span class="w">
                          </span><span class="c1">#repeats = 5, # Repeats K-fold cross-validation</span><span class="w">
                          </span><span class="n">verboseIter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="c1"># A logical for printing a training log.</span><span class="w">
                          </span><span class="n">returnData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="c1">#  A logical for saving the data into a slot called trainingData</span><span class="w">
                          </span><span class="n">allowParallel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="c1"># Use a parallel processing if available</span><span class="w">
                          </span><span class="n">sampling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"down"</span><span class="p">,</span><span class="w"> </span><span class="c1"># Balancing imbalanced dataset using random downsampling</span><span class="w">
                          </span><span class="n">classProbs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="c1">#  class probabilities be computed for classification models</span><span class="w">
                          </span><span class="n">summaryFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">twoClassSummary</span><span class="p">)</span><span class="w"> </span><span class="c1"># a function to computed alternate performance summaries.</span><span class="w">
</span></code></pre></div></div>

<h3 id="bagged-cart">Bagged CART</h3>
<p><span style="font-family:Georgia; font-size:18px;">
The following code accomplishes the bagged CART with a default of 25 bagged trees for faster computation.     </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#### Model 1 : Bagged CART</span><span class="w">
</span><span class="c1"># Setting seed for reproducibility</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">231</span><span class="p">,</span><span class="w"> </span><span class="n">sample.kind</span><span class="o">=</span><span class="s2">"Rounding"</span><span class="p">)</span><span class="w"> 
</span><span class="c1"># Train the model to find the best tune for bagged CART; </span><span class="w">
</span><span class="c1"># Used default nbagg=25 for faster computation</span><span class="w">
</span><span class="n">fit.bagcart</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
  </span><span class="n">train</span><span class="p">(</span><span class="w">
    </span><span class="n">make.names</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w">
    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imbal_train_set</span><span class="p">,</span><span class="w">  
    </span><span class="n">trControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fitControl</span><span class="p">,</span><span class="w">
    </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"treebag"</span><span class="p">,</span><span class="w">
    </span><span class="n">metric</span><span class="w"> </span><span class="o">=</span><span class="s2">"ROC"</span><span class="p">,</span><span class="w">
    </span><span class="n">tree_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hist"</span><span class="p">,</span><span class="w">
    </span><span class="n">nthread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
    </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1"># Predictions on imbalanced test set</span><span class="w">
</span><span class="n">pred.bagcart</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">fit.bagcart</span><span class="p">,</span><span class="w">
                           </span><span class="n">imbal_test_set</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">isFraud</span><span class="p">),</span><span class="w">
                           </span><span class="n">type</span><span class="o">=</span><span class="s2">"prob"</span><span class="p">)</span><span class="w">  
</span></code></pre></div></div>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ROC for Bagged CART</span><span class="w">
</span><span class="n">roctreebag_down</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">roc</span><span class="p">(</span><span class="n">imbal_test_set</span><span class="o">$</span><span class="n">isFraud</span><span class="p">,</span><span class="w">
                        </span><span class="n">factor</span><span class="p">(</span><span class="n">pred.bagcart</span><span class="o">$</span><span class="n">X1</span><span class="p">,</span><span class="w"> </span><span class="n">ordered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
                        </span><span class="n">plot</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                        </span><span class="n">smooth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
                        </span><span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                        </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#08519c"</span><span class="p">,</span><span class="w">
                        </span><span class="n">legacy.axes</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                        </span><span class="n">main</span><span class="o">=</span><span class="s2">"Bagged CART"</span><span class="p">,</span><span class="w">
                        </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1"</span><span class="p">))</span><span class="w">
</span><span class="n">roctreebag_down</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig19a.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 19: ROC Curve for Bagged CART </figcaption>
</figure>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">auc_results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Bagged CART"</span><span class="p">,</span><span class="w"> 
                      </span><span class="n">AUC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roctreebag_down</span><span class="o">$</span><span class="n">auc</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">auc_results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig19b.png" alt="this is a placeholder image" width="10%" height="30%" class="center" />
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
The AUC achieved by the bagged CART model corresponds to 0.93485. We then proceed to construct a variable importance plot (VIP) of the top 40 features in the bagged CART model.  </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vip</span><span class="o">::</span><span class="n">vip</span><span class="p">(</span><span class="n">fit.bagcart</span><span class="p">,</span><span class="w"> </span><span class="n">num_features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"point"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig20.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 20: Variable importance for 25 bagged trees for the Fraud Detection data. </figcaption>
</figure>

<h3 id="random-forest-1">Random Forest</h3>
<p><span style="font-family:Georgia; font-size:18px;">
In this section, we implement random forest algorithm for our fraud detection data. The mtry hyperparameter that controls split-variable randomization feature of random forests has been set to square root of the number of variables in our model.  </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Model 2 : Random Forest</span><span class="w">
</span><span class="c1"># mtry (The number of features to consider at any given split) for Classification models </span><span class="w">
</span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">floor</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">ncol</span><span class="p">(</span><span class="n">imbal_train_set</span><span class="p">)))</span><span class="w">
</span><span class="c1"># Creating hyperparameter grid search for Random Forest</span><span class="w">
</span><span class="n">rfgrid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">expand.grid</span><span class="p">(</span><span class="n">.mtry</span><span class="o">=</span><span class="n">mtry</span><span class="p">)</span><span class="w">
</span><span class="c1"># Setting seed for reproducibility </span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">112</span><span class="p">,</span><span class="w"> </span><span class="n">sample.kind</span><span class="o">=</span><span class="s2">"Rounding"</span><span class="p">)</span><span class="w"> 
</span><span class="c1"># Train the model to find the best tune for Random Forest</span><span class="w">
</span><span class="n">fit.randomforest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="w">
  </span><span class="n">make.names</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imbal_train_set</span><span class="p">,</span><span class="w">  
  </span><span class="n">trControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fitControl</span><span class="p">,</span><span class="w">
  </span><span class="n">tuneGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rfgrid</span><span class="p">,</span><span class="w">
  </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"rf"</span><span class="p">,</span><span class="w">
  </span><span class="n">tree_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hist"</span><span class="p">,</span><span class="w">
  </span><span class="n">metric</span><span class="w"> </span><span class="o">=</span><span class="s2">"ROC"</span><span class="p">,</span><span class="w">
  </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1"># Predict with imbalanced test set</span><span class="w">
</span><span class="n">pred.rf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">fit.randomforest</span><span class="p">,</span><span class="w">
                        </span><span class="n">imbal_test_set</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">isFraud</span><span class="p">),</span><span class="w">
                        </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"prob"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Generating ROC for the Random Forest model</span><span class="w">
</span><span class="n">rf_down</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">roc</span><span class="p">(</span><span class="n">imbal_test_set</span><span class="o">$</span><span class="n">isFraud</span><span class="p">,</span><span class="w">
                </span><span class="n">factor</span><span class="p">(</span><span class="n">pred.rf</span><span class="o">$</span><span class="n">X1</span><span class="p">,</span><span class="n">ordered</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
                </span><span class="n">plot</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                </span><span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#6a51a3"</span><span class="p">,</span><span class="w">  
                </span><span class="n">legacy.axes</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1"</span><span class="p">))</span><span class="w">
</span><span class="n">rf_down</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig21.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 21: ROC Curve for Random Forest </figcaption>
</figure>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">auc_results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> 
  </span><span class="n">rbind</span><span class="p">(</span><span class="n">auc_results</span><span class="p">,</span><span class="n">tibble</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Random Forest"</span><span class="p">,</span><span class="w"> 
                            </span><span class="n">AUC</span><span class="w"> </span><span class="o">=</span><span class="n">rf_down</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">auc_results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<figure>
  <img src="/img/Project/p4/fig21b.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
We observe that, we saw an improvement of AUC with the random forest algorithm. The AUC achieved by the bagged CART model corresponds to 0.94022. We then proceed to construct a variable importance plot (VIP) of the top 40 features in the bagged CART model. </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vip</span><span class="o">::</span><span class="n">vip</span><span class="p">(</span><span class="n">fit.randomforest</span><span class="p">,</span><span class="w"> </span><span class="n">num_features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"point"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig22.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 22: Variable importance for Random Forest for the Fraud Detection data. </figcaption>
</figure>

<h3 id="extreme-gradient-boostingxgboost-1">eXtreme Gradient Boosting(XGBOOST)</h3>
<p><span style="font-family:Georgia; font-size:18px;">
The following code accomplishes the XGBOOST with best tune parameters, obtained after a grid search on a hyperparameter grid of values. Boosting iterations has been restricted to 500 for optimal computational efficiency. The other parameters like maximum tree depth, learning rate/shrinkage, minimum loss reduction(gamma), subsample ratio of columns, maxiumum sum of instance weight and subsample percentage has been estimated after training the model with a hyperparameter grid of various values. </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Model 3 : XGBOOST (eXtreme Gradient Boosting)</span><span class="w">
</span><span class="c1"># Creating hyperparameter grid search for XGBOOST Hyperparameters with faster learning rate of 0.1</span><span class="w">
</span><span class="n">xgbGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expand.grid</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w">   </span><span class="c1"># Boosting Iterations : Number of trees or rounds</span><span class="w">
                      </span><span class="n">max_depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w">  </span><span class="c1"># c(5, 10, 15), # Max Tree Depth : Controls the depth of the individual trees</span><span class="w">
                      </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w">       </span><span class="c1"># Learning rate/ Shrinkage</span><span class="w">
                      </span><span class="n">gamma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w">       </span><span class="c1"># c(1, 2, 3), # Minimum Loss Reduction : Pseudo-regularization hyperparameter known as a Lagrangian multiplier and controls the complexity of a given tree.</span><span class="w">
                      </span><span class="n">colsample_bytree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="c1"># c(0.4, 0.7, 1.0), # Subsample Ratio of Columns</span><span class="w">
                      </span><span class="n">min_child_weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="c1"># c(0.5, 1, 1.5), # Minimum Sum of Instance Weight</span><span class="w">
                      </span><span class="n">subsample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.7</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1"># Subsample Percentage</span><span class="w">
                      
</span><span class="c1"># Setting seed for reproducibility</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">212</span><span class="p">,</span><span class="w"> </span><span class="n">sample.kind</span><span class="o">=</span><span class="s2">"Rounding"</span><span class="p">)</span><span class="w"> 
</span><span class="c1"># Train the model to find the best tune for XGBOOST</span><span class="w">
</span><span class="n">fit.xgboost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="w">
  </span><span class="n">make.names</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imbal_train_set</span><span class="p">,</span><span class="w">  
  </span><span class="n">trControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fitControl</span><span class="p">,</span><span class="w">
  </span><span class="n">tuneGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xgbGrid</span><span class="p">,</span><span class="w">
  </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"xgbTree"</span><span class="p">,</span><span class="w">
  </span><span class="n">tree_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hist"</span><span class="p">,</span><span class="w">
  </span><span class="n">metric</span><span class="w"> </span><span class="o">=</span><span class="s2">"ROC"</span><span class="p">,</span><span class="w">
  </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1"># Predict with imbalanced test set</span><span class="w">
</span><span class="n">pred.xgboost</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">fit.xgboost</span><span class="p">,</span><span class="w">
                           </span><span class="n">imbal_test_set</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">isFraud</span><span class="p">),</span><span class="w">
                           </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"prob"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Generating ROC for the XGBOOST model</span><span class="w">
</span><span class="n">xgb_down</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">roc</span><span class="p">(</span><span class="n">imbal_test_set</span><span class="o">$</span><span class="n">isFraud</span><span class="p">,</span><span class="w">
                </span><span class="n">factor</span><span class="p">(</span><span class="n">pred.xgboost</span><span class="o">$</span><span class="n">X1</span><span class="p">,</span><span class="n">ordered</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
                </span><span class="n">plot</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                </span><span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#993404"</span><span class="p">,</span><span class="w"> 
                </span><span class="n">legacy.axes</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1"</span><span class="p">))</span><span class="w">
</span><span class="n">xgb_down</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig23a.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 23: ROC Curve for XGBOOST </figcaption>
</figure>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">auc_results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> 
  </span><span class="n">rbind</span><span class="p">(</span><span class="n">auc_results</span><span class="p">,</span><span class="n">tibble</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"XGBOOST"</span><span class="p">,</span><span class="w"> 
                            </span><span class="n">AUC</span><span class="w"> </span><span class="o">=</span><span class="n">xgb_down</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">auc_results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<figure>
  <img src="/img/Project/p4/fig23b.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
We see further improvement in AUC with the XGBOOST algorithm. The AUC achieved by the XGBOOST model corresponds to 0.95903. We then proceed to construct a variable importance plot (VIP) of the top 40 features in the XGBOOST model.  </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vip</span><span class="o">::</span><span class="n">vip</span><span class="p">(</span><span class="n">fit.xgboost</span><span class="p">,</span><span class="w"> </span><span class="n">num_features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"point"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig24.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 24: Variable importance for XGBOOST for the Fraud Detection data.</figcaption>
</figure>

<h2 id="final-validation">Final Validation</h2>
<p><span style="font-family:Georgia; font-size:18px;">
Once we are confident about our final model, we measure AUC on the validation set, to estimate the generalization performance. This is the last step of prototyping phase where we will train a new model on the entire set using the best hyperparameters found. In the case of fraud detection dataset, the finalized model is XGBOOST model. Now, we train the complete model with the df dataset and estimate the AUC on validation set.   </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### AUC of finalized model(XGBOOST) with the validation set </span><span class="w">
</span><span class="c1"># Set random seed </span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">1234</span><span class="p">,</span><span class="w"> </span><span class="n">sample.kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Rounding"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Training the full model with the best tuning hyperparameters</span><span class="w">
</span><span class="n">fxgb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="w">
  </span><span class="n">make.names</span><span class="p">(</span><span class="n">isFraud</span><span class="p">)</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="w">
  </span><span class="n">trControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fitControl</span><span class="p">,</span><span class="w">
  </span><span class="n">tuneGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xgbGrid</span><span class="p">,</span><span class="w">
  </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"xgbTree"</span><span class="p">,</span><span class="w">
  </span><span class="n">tree_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hist"</span><span class="p">,</span><span class="w">
  </span><span class="n">metric</span><span class="w"> </span><span class="o">=</span><span class="s2">"ROC"</span><span class="p">,</span><span class="w">
  </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1"># Predictions on the validation set</span><span class="w">
</span><span class="n">pred.xgboost</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">fxgb</span><span class="p">,</span><span class="w">
                           </span><span class="n">feature_engg_fraud_det</span><span class="p">(</span><span class="n">validation_x</span><span class="p">),</span><span class="w">
                           </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"prob"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Generating ROC Curve for XGBOOST on validation dataset</span><span class="w">
</span><span class="n">rocxgb_down_validation</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">roc</span><span class="p">(</span><span class="n">validation_y</span><span class="o">$</span><span class="n">isFraud</span><span class="p">,</span><span class="w">
                              </span><span class="n">factor</span><span class="p">(</span><span class="n">pred.xgboost</span><span class="o">$</span><span class="n">X1</span><span class="p">,</span><span class="n">ordered</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
                              </span><span class="n">plot</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                              </span><span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                              </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#006d2c"</span><span class="p">,</span><span class="w"> </span><span class="c1"># green</span><span class="w">
                              </span><span class="n">legacy.axes</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                              </span><span class="n">main</span><span class="o">=</span><span class="s2">"AUC with XGBOOST(Validation Set)"</span><span class="p">,</span><span class="w">
                              </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1"</span><span class="p">))</span><span class="w">
</span><span class="n">rocxgb_down_validation</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">auc_results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> 
  </span><span class="n">rbind</span><span class="p">(</span><span class="n">auc_results</span><span class="p">,</span><span class="n">tibble</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"XGBOOST (Validation Set)"</span><span class="p">,</span><span class="w"> 
                            </span><span class="n">AUC</span><span class="w"> </span><span class="o">=</span><span class="n">rocxgb_down_validation</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">auc_results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/auc_validation set.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Results : AUC with XGBOOST(Validation Set) </figcaption>
</figure>

<p><span style="font-family:Georgia; font-size:18px;">
The AUC achieved by the XGBOOST on validation set corresponds to 0.95618. We then proceed to construct a variable importance plot (VIP) of the top 40 features in the XGBOOST model on validation set. </span></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vip</span><span class="o">::</span><span class="n">vip</span><span class="p">(</span><span class="n">fxgb</span><span class="p">,</span><span class="w"> </span><span class="n">num_features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"point"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/img/Project/p4/fig25.png" alt="this is a placeholder image" width="100%" height="50%" class="center" />
  <figcaption style="color: grey"> Figure 25: Variable importance XGBOOST (on entire data) </figcaption>
</figure>

<h1 id="conclusion">Conclusion</h1>

<p><span style="font-family:Georgia; font-size:18px;">
The performance of each of the algorithms can be significantly improved with higher number of iterations in case of bagged CART and number of boosting iterations in case of XGBOOST. Regardless of the the computational intensity of the algorithms discussed above, it is vital to note that gradient boosting machines are one of the most powerful ensemble algorithms offering excellent accuracy. Although, we discussed XGBOOST(one of the most popular GBMs), there are better alternatives for this as well. One of them, is the CatBoost that uses efficient methods for encoding categorical features and is expected to perform well in situations with frequent changes in data. Yet another alternative for traditional GBMs is, the LightGBM. It focuses on leaf-wise tree growth versus the level-wise tree growth of the traditional GBMs. It offers key advantages of faster training speed, lower memory usage among others.  </span></p>

<p><span style="font-family:Georgia; font-size:18px;">
Thanks for reading! If you want to get in touch with me or leave me any feedback, feel free to reach me on my email. You can find the complete script in my <a href="https://github.com/prabhupavitra/ieee-cis-fraud-detection">github repository</a>.</span></p>

<h5 id="references">References</h5>

<p><span style="font-family:Georgia; font-size:18px;">
(1) Baesens, Bart, Véronique van Vlasselaer, and Wouter Verbeke. Fraud Analytics Using Descriptive, Predictive, and Social Network Techniques  : Guide to Data Science for Fraud Detection / Bart Baesens, Veronique Van Vlasselaer, Wouter Verbeke. 1st edition. Hoboken, New Jersey: John Wiley &amp; Sons, 2015.</span></p>

<p><span style="font-family:Georgia; font-size:18px;">
(2) Alice Zheng, Amanda Casari. Feature Engineering for Machine Learning: Principles and Techniques for Data Scientists.O’Reilly Media, Inc.April 2018.</span></p>

<p><span style="font-family:Georgia; font-size:18px;">
(3) Alice Zheng. Evaluating Machine Learning Models.O’Reilly Media, Inc.September 2015</span></p>

<p><span style="font-family:Georgia; font-size:18px;">
(4) Matt Harrison. Machine Learning Pocket Reference. O’Reilly Media, Inc.August 2019</span></p>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-12-01T21:12:28-06:00">December 1, 2020</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/projects/movie-recommender-in-r/" class="pagination--pager" title="Movie Recommender system
">Previous</a>
    
    
      <a href="/projects/collaborative-filtering-using-pyspark/" class="pagination--pager" title="Implicit Collaborative Filtering with PySpark
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://github.com/prabhupavitra?tab=repositories" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Pavitra Prabhu. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>










  </body>
</html>
